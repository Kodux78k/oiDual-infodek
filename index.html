<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>DUAL // UNIFIED · OS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#020202">
  <meta name="description" content="DUAL Unified — Code Vault & Runtime Environment">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;400;500;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            ui: ['Inter', 'sans-serif'],
            code: ['JetBrains Mono', 'monospace'],
          },
          colors: {
            dual: {
              bg: '#020202',
              glass: 'rgba(15, 15, 20, 0.75)',
              border: 'rgba(255, 255, 255, 0.08)',
              cyan: '#00f2ff',
              purple: '#bd00ff',
              alert: '#ff4d4d',
            }
          },
          animation: {
            'scan': 'scan 3s linear infinite',
            'spin-slow': 'spin 8s linear infinite',
            'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
          },
          keyframes: {
            scan: {
              '0%': { transform: 'translateX(-100%)' },
              '100%': { transform: 'translateX(200%)' }
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            }
          }
        }
      }
    }
  </script>

  <style>
    :root {
      --glass-surface: rgba(12, 12, 14, 0.7);
      --glass-border: rgba(255, 255, 255, 0.08);
      --neon-cyan: #00f2ff;
    }
    body { background-color: #020202; overflow: hidden; }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--neon-cyan); }

    /* Monolith 3D Effect */
    .monolith-wrapper {
      perspective: 1200px;
      transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    }
    .monolith {
      background: var(--glass-surface);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border: 1px solid var(--glass-border);
      box-shadow: 0 40px 80px -12px rgba(0, 0, 0, 0.8);
      transform-style: preserve-3d;
      opacity: 0;
      transform: translateY(60px) rotateX(10deg) scale(0.95);
      transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      pointer-events: none;
    }
    body.system-active .monolith {
      opacity: 1;
      transform: translateY(0) rotateX(0) scale(1);
      pointer-events: auto;
    }

    /* Runtime Layer */
    .runtime-layer {
      transform: translateY(100%);
      transition: transform 0.5s cubic-bezier(0.76, 0, 0.24, 1);
    }
    .runtime-layer.visible { transform: translateY(0); }

    /* Ambient */
    .void-ambient {
      position: fixed; inset: 0; pointer-events: none;
      background: radial-gradient(circle at 50% 120%, rgba(0, 242, 255, 0.05), transparent 60%);
    }

    /* Orb */
    .orb-container {
      transition: all 0.5s ease;
    }
    body.system-active .orb-container {
      bottom: 2rem; transform: translateX(-50%) scale(0.8);
    }
    .orb {
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(10px);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.1), 0 0 30px rgba(0,242,255,0.15);
      transition: 0.3s;
    }
    .orb:hover { box-shadow: 0 0 0 1px var(--neon-cyan), 0 0 50px rgba(0,242,255,0.4); }

    /* Scanline overlay */
    .scanline {
      background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
      background-size: 100% 4px;
      pointer-events: none;
    }
    
    .hidden { display: none !important; }
  </style>
</head>
<body class="antialiased text-white selection:bg-dual-cyan selection:text-black font-ui">

  <!-- Ambient & Nav Frame -->
  <div class="void-ambient z-0"></div>
  <iframe id="navFrame" src="./index.html" class="fixed inset-0 w-full h-full border-0 z-0 bg-black opacity-50 transition-opacity duration-500"></iframe>

  <!-- Top Bar -->
  <div class="fixed top-6 left-1/2 -translate-x-1/2 z-40 flex items-center gap-4 bg-black/40 backdrop-blur px-4 py-2 rounded-full border border-white/5">
    <div class="text-xs font-code text-gray-400 tracking-widest">DUAL // UNIFIED</div>
    <div class="h-3 w-[1px] bg-white/20"></div>
    <button id="themeToggle" class="text-gray-400 hover:text-white transition-colors"><i class="fa-solid fa-circle-half-stroke"></i></button>
  </div>

  <!-- Right Sidebar (Navigator) - COMPACT -->
  <div class="fixed right-2 top-1/2 -translate-y-1/2 flex flex-col gap-2 z-40">
    <button class="w-8 h-8 rounded-lg bg-black/40 border border-white/5 text-dual-cyan hover:bg-dual-cyan hover:text-black transition-all backdrop-blur-sm flex items-center justify-center font-code text-sm" data-url="about:blank" title="Void">Φ</button>
    <button class="w-8 h-8 rounded-lg bg-black/40 border border-white/5 text-dual-cyan hover:bg-dual-cyan hover:text-black transition-all backdrop-blur-sm flex items-center justify-center font-code text-sm" data-url="https://kodux78k.github.io/oiDual-Vivivi-1/" title="Vivivi">꩜</button>
    <button class="w-8 h-8 rounded-lg bg-black/40 border border-white/5 text-dual-cyan hover:bg-dual-cyan hover:text-black transition-all backdrop-blur-sm flex items-center justify-center font-code text-sm" data-url="https://kodux78k.github.io/NosSolar-dualInfodose/" title="Nosolar">☼</button>
  </div>

  <!-- Left Sidebar (Tools) - COMPACT -->
  <div class="fixed left-2 top-1/2 -translate-y-1/2 flex flex-col gap-2 z-40">
    <button id="uploadBtn" class="w-8 h-8 rounded-lg bg-black/40 border border-white/5 text-gray-400 hover:text-white hover:border-dual-cyan/50 transition-all backdrop-blur-sm flex items-center justify-center"><i class="fa-solid fa-upload"></i></button>
    <input type="file" id="uploadInput" hidden accept=".html,.js,.json">
    <button id="remoteBtn" class="w-8 h-8 rounded-lg bg-black/40 border border-white/5 text-gray-400 hover:text-white hover:border-dual-cyan/50 transition-all backdrop-blur-sm flex items-center justify-center"><i class="fa-solid fa-globe"></i></button>
  </div>

  <!-- MONOLITH (Main UI) -->
  <div class="monolith-wrapper fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none">
    <div class="monolith w-full max-w-5xl h-[80vh] max-h-[850px] rounded-3xl flex flex-col overflow-hidden relative shadow-2xl">
      
      <!-- Header -->
      <div class="flex justify-between items-center px-6 py-5 border-b border-white/5 bg-white/[0.02]">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 rounded bg-dual-cyan/10 flex items-center justify-center border border-dual-cyan/20">
            <i data-lucide="layers" class="text-dual-cyan w-4 h-4"></i>
          </div>
          <div class="font-ui font-bold tracking-wide text-sm text-gray-200">DUAL <span class="text-white/30">//</span> MONOLITH</div>
        </div>
        <div id="sysStatus" class="font-code text-[10px] px-2 py-1 rounded bg-white/5 border border-white/5 text-gray-500 tracking-widest uppercase">STANDBY</div>
      </div>

      <!-- Content Area -->
      <div class="flex-1 flex overflow-hidden relative">
        
        <!-- View: VAULT (List) -->
        <div id="viewVault" class="w-full h-full flex flex-col p-6 overflow-y-auto transition-transform duration-500">
          
          <!-- Actions -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
            <button id="createBtn" class="flex items-center justify-center gap-2 p-4 rounded-xl bg-dual-cyan text-black font-bold hover:bg-white transition-all shadow-lg shadow-dual-cyan/20">
              <i data-lucide="plus-square" class="w-4 h-4"></i>
              <span>NOVO</span>
            </button>
            <div id="dropZone" class="flex items-center justify-center gap-2 p-4 rounded-xl border border-dashed border-white/20 hover:border-dual-cyan hover:bg-dual-cyan/5 text-gray-400 hover:text-white cursor-pointer transition-all">
              <i data-lucide="upload" class="w-4 h-4"></i>
              <span class="text-sm font-code">UPLOAD</span>
            </div>
            <button id="infodoseBtn" class="flex items-center justify-center gap-2 p-4 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 hover:border-dual-cyan/30 transition-all">
              <i data-lucide="zap" class="w-4 h-4 text-dual-cyan"></i>
              <span class="text-sm">INFODOSE</span>
            </button>
            <button id="safeBtn" class="flex items-center justify-center gap-2 p-4 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 hover:border-dual-alert/30 transition-all group">
              <i data-lucide="shield" class="w-4 h-4 text-dual-alert group-hover:text-white"></i>
              <span class="text-sm" id="safeLabel">SAFE</span>
            </button>
          </div>

          <!-- List -->
          <div class="flex items-center justify-between mb-3 px-1">
            <span class="text-xs font-code text-gray-500">VAULT STORAGE</span>
            <span class="text-xs font-code text-gray-600" id="vaultCount">0 ITEMS</span>
          </div>
          <div id="stackList" class="flex flex-col gap-3 pb-12">
            <!-- Dynamic Items -->
          </div>
        </div>

        <!-- View: EDITOR (Uno) -->
        <div id="viewEditor" class="absolute inset-0 bg-[#08080a] p-6 flex flex-col transform translate-x-full transition-transform duration-500 z-10">
          <div class="flex justify-between items-center mb-4">
            <div class="text-dual-cyan font-code text-sm">:: MODULE CREATOR</div>
            <button id="cancelEditor" class="text-xs bg-white/10 hover:bg-white/20 px-3 py-1 rounded text-gray-300">CANCELAR</button>
          </div>
          
          <input id="modTitle" type="text" placeholder="NOME DO MÓDULO (ex: Widget Clima)" class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-sm font-code text-white mb-3 focus:border-dual-cyan focus:outline-none placeholder-gray-600">
          
          <div class="flex-1 relative border border-white/10 rounded-lg overflow-hidden bg-black/50">
            <textarea id="modContent" class="w-full h-full bg-transparent p-4 text-xs font-code text-green-400 focus:outline-none resize-none" placeholder="<!-- Escreva seu HTML/CSS/JS aqui -->"></textarea>
          </div>
          
          <div class="flex gap-3 mt-4">
            <button id="saveEditor" class="flex-1 bg-dual-cyan text-black font-bold py-3 rounded-xl hover:bg-white transition-colors">SALVAR NO VAULT</button>
          </div>
        </div>

      </div>

      <!-- Pulse Footer -->
      <div class="h-1 w-full bg-black mt-auto relative overflow-hidden">
        <div id="pulseBar" class="absolute inset-y-0 left-0 w-1/2 bg-gradient-to-r from-transparent via-dual-cyan to-transparent animate-scan opacity-0 transition-opacity"></div>
      </div>

      <!-- Runtime Overlay (Inside Monolith) -->
      <div id="runtimeLayer" class="runtime-layer absolute inset-0 bg-black z-20 flex flex-col">
        <div class="h-10 bg-[#0a0a0c] border-b border-white/10 flex items-center justify-between px-4 shrink-0">
          <div class="flex items-center gap-2">
            <div class="w-2 h-2 rounded-full bg-dual-cyan animate-pulse"></div>
            <span class="font-code text-xs text-dual-cyan tracking-wider">RUNTIME // ACTIVE</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="exportBtn" class="text-[10px] bg-white/10 hover:bg-white/20 px-2 py-1 rounded text-gray-400 hover:text-white transition-colors">EXPORT TO NAV</button>
            <button id="closeRuntime" class="w-6 h-6 flex items-center justify-center text-gray-500 hover:text-red-500 hover:bg-white/5 rounded transition-colors"><i data-lucide="x" class="w-4 h-4"></i></button>
          </div>
        </div>
        <div class="flex-1 relative bg-white">
          <iframe id="appFrame" class="w-full h-full border-0" sandbox="allow-scripts allow-forms allow-modals allow-same-origin allow-pointer-lock"></iframe>
          <div class="scanline absolute inset-0 pointer-events-none opacity-20 mix-blend-overlay"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Orb Trigger (Compact) -->
  <div class="orb-container fixed bottom-6 left-1/2 -translate-x-1/2 z-[60]">
    <button id="orbBtn" class="orb w-14 h-14 rounded-full flex items-center justify-center relative group" aria-label="Toggle System">
      <div class="w-2 h-2 bg-white rounded-full shadow-[0_0_15px_white] transition-all group-hover:bg-dual-cyan group-hover:shadow-[0_0_25px_#00f2ff]"></div>
      <div class="absolute inset-1 rounded-full border border-t-dual-cyan/60 border-r-transparent border-b-transparent border-l-transparent animate-spin-slow opacity-60"></div>
      <div class="absolute inset-3 rounded-full border border-b-dual-purple/60 border-l-transparent border-t-transparent border-r-transparent animate-spin-slow opacity-40" style="animation-direction: reverse;"></div>
    </button>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed top-20 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg bg-black/90 border border-dual-cyan/30 text-dual-cyan font-code text-xs shadow-2xl z-[100] transition-all duration-300 opacity-0 pointer-events-none translate-y-[-10px]">
    <span id="toastMsg">System Ready</span>
  </div>

  <!-- Modal Loader Component -->
  <script>
    class MyFrameLoader extends HTMLElement {
      constructor(){
        super();
        this.attachShadow({mode:'open'});
        this.shadowRoot.innerHTML = `
          <style>
            :host { all: initial; font-family: sans-serif; }
            .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; z-index: 99999; }
            .box { width: 90%; height: 85%; background: #000; border: 1px solid #333; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
            .header { padding: 8px 12px; border-bottom: 1px solid #222; display: flex; justify-content: flex-end; background: #0a0a0a; }
            button { background: none; border: none; color: #fff; cursor: pointer; font-size: 16px; opacity: 0.6; }
            button:hover { opacity: 1; color: #f00; }
            iframe { flex: 1; border: none; background: #fff; }
            @keyframes pop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
          </style>
          <div class="overlay"><div class="box">
            <div class="header"><button id="c">✕</button></div>
            <iframe sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
          </div></div>
        `;
        this.iframe = this.shadowRoot.querySelector('iframe');
        this.shadowRoot.querySelector('#c').onclick = () => this.remove();
        this.shadowRoot.querySelector('.overlay').onclick = (e) => { if(e.target===e.currentTarget) this.remove(); }
      }
      set src(v){ this.iframe.src = v; }
    }
    customElements.define('my-frame-loader', MyFrameLoader);
  </script>

  <script>
    const App = {
      config: {
        vaultKey: 'dual_unified_vault',
        themeKey: 'dual_theme',
        navKey: 'dual_nav_last'
      },
      state: {
        active: false,
        safeMode: true,
        infodose: false,
        stacks: []
      },
      
      init() {
        this.cacheDOM();
        this.loadData();
        this.bindEvents();
        if(window.lucide) lucide.createIcons();
        
        // Boot Sequence
        setTimeout(() => this.toggleSystem(true), 600);
      },

      cacheDOM() {
        this.dom = {
          body: document.body,
          navFrame: document.getElementById('navFrame'),
          orbBtn: document.getElementById('orbBtn'),
          sysStatus: document.getElementById('sysStatus'),
          stackList: document.getElementById('stackList'),
          viewVault: document.getElementById('viewVault'),
          viewEditor: document.getElementById('viewEditor'),
          runtimeLayer: document.getElementById('runtimeLayer'),
          appFrame: document.getElementById('appFrame'),
          modTitle: document.getElementById('modTitle'),
          modContent: document.getElementById('modContent'),
          toast: document.getElementById('toast'),
          pulseBar: document.getElementById('pulseBar'),
          safeLabel: document.getElementById('safeLabel')
        };
      },

      bindEvents() {
        // System Toggle
        this.dom.orbBtn.addEventListener('click', () => this.toggleSystem());
        
        // Navigation Buttons (Right Sidebar)
        document.querySelectorAll('[data-url]').forEach(btn => {
          btn.addEventListener('click', () => {
            this.dom.navFrame.src = btn.dataset.url;
            this.showToast(`NAV: ${btn.title}`);
          });
        });

        // Editor Controls
        document.getElementById('createBtn').addEventListener('click', () => this.toggleEditor(true));
        document.getElementById('cancelEditor').addEventListener('click', () => this.toggleEditor(false));
        document.getElementById('saveEditor').addEventListener('click', () => this.saveModule());
        
        // Vault Actions
        document.getElementById('dropZone').addEventListener('click', () => document.getElementById('uploadInput').click());
        document.getElementById('uploadInput').addEventListener('change', (e) => this.handleUpload(e));
        document.getElementById('uploadBtn').addEventListener('click', () => document.getElementById('uploadInput').click());
        
        // Features
        document.getElementById('safeBtn').addEventListener('click', () => this.toggleSafe());
        document.getElementById('infodoseBtn').addEventListener('click', () => this.toggleInfodose());
        document.getElementById('themeToggle').addEventListener('click', () => {
           this.dom.body.classList.toggle('theme-light');
           this.showToast("THEME TOGGLED");
        });
        
        // Runtime
        document.getElementById('closeRuntime').addEventListener('click', () => this.closeRuntime());
        document.getElementById('exportBtn').addEventListener('click', () => {
          if(this.dom.appFrame.srcdoc) {
            const blob = new Blob([this.dom.appFrame.srcdoc], {type:'text/html'});
            this.dom.navFrame.src = URL.createObjectURL(blob);
            this.showToast("EXPORTED TO NAV");
            this.closeRuntime();
          }
        });
      },

      loadData() {
        // Vault
        try {
          const raw = localStorage.getItem(this.config.vaultKey);
          if(raw) this.state.stacks = JSON.parse(raw);
        } catch(e) { this.state.stacks = []; }
        this.renderVault();
        
        // Nav Persistence
        const last = localStorage.getItem(this.config.navKey);
        if(last && last !== 'about:blank') this.dom.navFrame.src = last;
        
        this.dom.navFrame.onload = () => {
          try { localStorage.setItem(this.config.navKey, this.dom.navFrame.contentWindow.location.href); } catch(e){}
        };
      },

      toggleSystem(force) {
        this.state.active = force !== undefined ? force : !this.state.active;
        if(this.state.active) {
          this.dom.body.classList.add('system-active');
          this.dom.sysStatus.innerText = "ONLINE";
          this.dom.sysStatus.style.color = "var(--neon-cyan)";
          this.dom.sysStatus.style.borderColor = "rgba(0,242,255,0.3)";
        } else {
          this.dom.body.classList.remove('system-active');
          this.dom.sysStatus.innerText = "STANDBY";
          this.dom.sysStatus.style.color = "#666";
          this.dom.sysStatus.style.borderColor = "rgba(255,255,255,0.05)";
        }
      },

      toggleEditor(show) {
        if(show) {
          this.dom.viewEditor.classList.remove('translate-x-full');
          this.dom.modTitle.value = '';
          this.dom.modContent.value = '';
          this.dom.modTitle.focus();
        } else {
          this.dom.viewEditor.classList.add('translate-x-full');
        }
      },

      toggleSafe() {
        this.state.safeMode = !this.state.safeMode;
        this.dom.safeLabel.innerText = this.state.safeMode ? "SAFE" : "RAW";
        this.dom.safeLabel.style.color = this.state.safeMode ? "inherit" : "#ff4d4d";
        this.showToast(this.state.safeMode ? "PROTOCOL: SAFE" : "PROTOCOL: RAW (UNSAFE)");
      },
      
      toggleInfodose() {
        this.state.infodose = !this.state.infodose;
        this.dom.pulseBar.style.opacity = this.state.infodose ? '1' : '0';
        this.showToast(this.state.infodose ? "INFODOSE LINKED" : "INFODOSE UNLINKED");
      },

      saveModule() {
        const title = this.dom.modTitle.value.trim();
        const content = this.dom.modContent.value.trim();
        if(!title) return this.showToast("ERROR: TITLE REQUIRED");
        
        const mod = {
          id: Date.now(),
          title,
          content: content || '<h1>Empty Module</h1>',
          date: new Date().toLocaleDateString()
        };
        
        this.state.stacks.unshift(mod);
        localStorage.setItem(this.config.vaultKey, JSON.stringify(this.state.stacks));
        this.renderVault();
        this.toggleEditor(false);
        this.showToast("MODULE CRYSTALLIZED");
      },

      handleUpload(e) {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          this.state.stacks.unshift({
            id: Date.now(),
            title: file.name,
            content: ev.target.result,
            date: new Date().toLocaleDateString()
          });
          localStorage.setItem(this.config.vaultKey, JSON.stringify(this.state.stacks));
          this.renderVault();
          this.showToast("FILE UPLOADED");
        };
        reader.readAsText(file);
      },

      deleteModule(id) {
        if(!confirm("DELETE MODULE?")) return;
        this.state.stacks = this.state.stacks.filter(s => s.id !== id);
        localStorage.setItem(this.config.vaultKey, JSON.stringify(this.state.stacks));
        this.renderVault();
      },

      renderVault() {
        this.dom.stackList.innerHTML = '';
        document.getElementById('vaultCount').innerText = `${this.state.stacks.length} ITEMS`;
        
        if(this.state.stacks.length === 0) {
          this.dom.stackList.innerHTML = `<div class="text-center py-8 text-gray-600 font-code text-xs">VAULT EMPTY</div>`;
          return;
        }

        this.state.stacks.forEach(stack => {
          const el = document.createElement('div');
          el.className = 'flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/5 hover:border-dual-cyan/30 group transition-all cursor-pointer';
          el.innerHTML = `
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded bg-black/40 flex items-center justify-center text-dual-cyan/70 group-hover:text-dual-cyan transition-colors">
                <i data-lucide="box" class="w-4 h-4"></i>
              </div>
              <div class="overflow-hidden">
                <div class="font-bold text-sm text-gray-300 group-hover:text-white truncate">${stack.title}</div>
                <div class="text-[10px] text-gray-500 font-code">${stack.date}</div>
              </div>
            </div>
            <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
              <button class="run-btn w-8 h-8 rounded-lg bg-dual-cyan text-black hover:bg-white flex items-center justify-center transition-colors"><i data-lucide="play" class="w-3 h-3 fill-current"></i></button>
              <button class="del-btn w-8 h-8 rounded-lg border border-red-500/30 text-red-500 hover:bg-red-500 hover:text-white flex items-center justify-center transition-colors"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
            </div>
          `;
          
          el.querySelector('.run-btn').onclick = (e) => { e.stopPropagation(); this.runModule(stack.id); };
          el.querySelector('.del-btn').onclick = (e) => { e.stopPropagation(); this.deleteModule(stack.id); };
          el.onclick = () => this.runModule(stack.id);
          
          this.dom.stackList.appendChild(el);
        });
        
        if(window.lucide) lucide.createIcons();
      },

      runModule(id) {
        const mod = this.state.stacks.find(s => s.id === id);
        if(!mod) return;
        
        let code = mod.content;
        if(this.state.safeMode) {
          try {
             if(!code.includes('<html') && !code.includes('<!doctype')) {
               code = `<style>body{color:#fff;background:transparent;font-family:sans-serif}</style>${code}`;
             }
          } catch(e){}
        }

        this.dom.appFrame.srcdoc = code;
        this.dom.runtimeLayer.classList.add('visible');
        this.dom.sysStatus.innerText = "RUNNING";
        this.dom.sysStatus.classList.add('animate-pulse');
      },

      closeRuntime() {
        this.dom.runtimeLayer.classList.remove('visible');
        this.dom.sysStatus.classList.remove('animate-pulse');
        this.dom.sysStatus.innerText = "ONLINE";
        setTimeout(() => this.dom.appFrame.srcdoc = '', 400);
      },

      showToast(msg) {
        this.dom.toast.innerText = msg;
        this.dom.toast.classList.remove('opacity-0', 'translate-y-[-10px]');
        clearTimeout(this.toastTimer);
        this.toastTimer = setTimeout(() => {
          this.dom.toast.classList.add('opacity-0', 'translate-y-[-10px]');
        }, 2000);
      }
    };

    window.onload = () => App.init();
  </script>
</body>
</html>